# 专线抖动异常检测算法

---

### 算法名称：基于“错误率梯度”的故障定界算法

**(Error Rate Gradient-based Fault Localization)**

#### 一、 只有三步（How）

1. **归一化 (Normalize)：**
* 不看绝对错误数，计算所有报错服务的**错误率**（Error Rate = 错误数 / 请求数）。
* *目的：抹平大小服务的流量差异。*


2. **排序 (Sort)：**
* 将所有异常服务的错误率从高到低排序。


3. **判决 (Judge)：**
* 检查相邻服务的错误率**梯度（倍数差）**。
* **如果是断崖（>3倍）：** 判定为**单体应用故障**（排在第一位的应用是根因）。
* **如果是平台（<3倍）：** 判定为**网络/基础设施故障**（大面积共性问题）。



---

#### 二、 核心原理（Why）

**1. 物理学原理：能量衰减 (Energy Decay)**

* **应用故障**是“点源爆发”，能量从中心向外剧烈衰减（主服务死透，下游轻伤），形成**陡峭梯度**。
* **网络故障**是“场域攻击”，能量在区域内均匀分布（无差别丢包），形成**平缓梯度**。

**2. 统计学原理：贝叶斯似然比 (Bayesian Likelihood Ratio)**

* **证据 (E)：** 观测到“错误率分布均匀（无3倍差）”。
* **推论：**
* 如果是网络故障，出现均匀分布的概率 （必然）。
* 如果是应用故障，出现均匀分布的概率 （万分之一的巧合）。
* **似然比** = 。


* **结论：** 一旦出现“平缓梯度”，它是网络故障的可能性是应用故障的 **10000倍**。

---

#### 三、 为什么不需要皮尔逊算法？

* **皮尔逊 (Pearson)** 只能识别“动作齐不齐”（时序相关性）。
* **应用级联故障**时，动作也是齐的（大哥挂，小弟跟着挂），皮尔逊会**误报**。
* **本算法** 识别的是“伤势均不均”（强度一致性），这是区分“单点级联”与“全面打击”的**唯一黄金特征**。
